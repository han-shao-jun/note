## 前言
在学习u-boot之前得对u-boot整体代码哟宏观上的认识，在后面学习某一个模块时能定位需要查看的代码范围。在编译后有很多文件产生，对于这些文件有什么作用，怎么产生的，对烧写u-boot固件和调试有帮助。在学习u-boot时能过滤，也能减轻负担
***


## 文件结构

```shell
super@rocket:~/Downloads/u-boot$ ls -l
total 4776
drwxrwxr-x   2 super super    4096  6月 16 22:38 api
drwxrwxr-x  14 super super    4096  6月 16 22:38 arch
drwxrwxr-x 193 super super    4096  6月 16 22:38 board
drwxrwxr-x   2 super super    4096 10月 21 22:18 boot
-rwxrwxr-x   1 super super      70  6月 17 11:23 build.sh
drwxrwxr-x   2 super super    4096 10月  1 21:28 cmake
drwxrwxr-x   5 super super    4096 10月 19 21:58 cmake-build-debug
-rw-rw-r--   1 super super     152  6月  7 20:35 CMakeLists.txt
-rwxrwxr-x   1 super super    4306  7月  9 22:42 cmake_tool.py
drwxrwxr-x  10 super super   12288 10月 21 22:18 cmd
drwxrwxr-x   5 super super    4096 10月 21 22:18 common
-rw-rw-r--   1 super super  334562 10月 19 21:58 compile_commands.json
-rw-rw-r--   1 super super    2180  6月 16 22:38 config.mk
drwxrwxr-x   2 super super   69632 10月  8 22:36 configs
drwxrwxr-x   2 super super    4096 10月 21 22:18 disk
drwxrwxr-x  19 super super    4096  6月 16 22:38 doc
drwxrwxr-x  76 super super    4096 10月 21 22:18 drivers
drwxrwxr-x   2 super super    4096 10月 21 22:18 dts
drwxrwxr-x   2 super super    4096 10月 21 22:18 env
drwxrwxr-x   4 super super    4096  6月 16 22:38 examples
drwxrwxr-x  14 super super    4096 10月 21 22:18 fs
drwxrwxr-x  40 super super   20480 10月 21 22:18 include
-rw-rw-r--   1 super super     783  6月 16 22:38 Kbuild
-rw-rw-r--   1 super super   25414  6月 16 22:38 Kconfig
drwxrwxr-x  24 super super   12288 10月 21 22:18 lib
drwxrwxr-x   2 super super    4096  6月 16 22:38 Licenses
-rw-rw-r--   1 super super   46403  6月 16 22:38 MAINTAINERS
-rw-rw-r--   1 super super   83600 10月  9 23:55 Makefile
drwxrwxr-x   2 super super    4096 10月 21 22:18 net
drwxrwxr-x   5 super super    4096  6月 16 22:38 post
-rw-rw-r--   1 super super   93584  6月 16 22:38 README
drwxrwxr-x   6 super super    4096  6月 19 21:16 scripts
-rw-rw-r--   1 super super     215 10月  2 14:54 stm32h743Jlink.cfg
-r--r--r--   1 super super 4062365  6月 22 22:43 STM32H743.svd
drwxrwxr-x  18 super super    4096  6月 16 22:38 test
drwxrwxr-x  15 super super   12288 10月 21 22:18 tools
```

u-boot支持多种架构的SOC，例如x86架构的CPU、ARMV7-A(arm32)、ARMV8-A(arm64)，对于不同架构的SOC一些处理器相关的代码也不同，SOC的外设接口也不同，使用kconfig图形化方式按需配置管理源代码(与Linux内核相同)

### arch文件夹
SOC内核架构文件夹，其中arm32，arm64架构都在arm文件夹下

```shell
super@rocket:~/Downloads/u-boot/arch$ ls -l
total 76
drwxrwxr-x  6 super super  4096  6月 16 22:38 arc
drwxrwxr-x 55 super super  4096  6月 16 22:38 arm
-rw-rw-r--  1 super super 13810  6月 16 22:38 Kconfig
-rw-rw-r--  1 super super  8022  6月 16 22:38 Kconfig.nxp
drwxrwxr-x  6 super super  4096  6月 16 22:38 m68k
drwxrwxr-x  6 super super  4096  6月 16 22:38 microblaze
drwxrwxr-x 13 super super  4096  6月 16 22:38 mips
drwxrwxr-x  6 super super  4096  6月 16 22:38 nios2
drwxrwxr-x  6 super super  4096  6月 16 22:38 powerpc
drwxrwxr-x  6 super super  4096  6月 16 22:38 riscv
drwxrwxr-x  6 super super  4096  6月 16 22:38 sandbox
drwxrwxr-x  6 super super  4096  6月 16 22:38 sh
-rw-rw-r--  1 super super   103  6月 16 22:38 u-boot-elf.lds
drwxrwxr-x  6 super super  4096  6月 16 22:38 x86
drwxrwxr-x  6 super super  4096  6月 16 22:38 xtensa
```

### arch/arm文件夹
arm文件夹下以 **mach-** 开始的文件夹都是半导体厂商SOC相关的代码

```shell
super@rocket:~/Downloads/u-boot/arch/arm$ ls -l
total 412
-rw-rw-r--  1 super super   5077  6月 16 22:38 config.mk
drwxrwxr-x 12 super super   4096 10月 22 20:48 cpu
drwxrwxr-x  3 super super 131072 10月 22 20:48 dts
drwxrwxr-x  4 super super   4096  6月 16 22:38 include
-rw-rw-r--  1 super super  58503  6月 16 22:38 Kconfig
-rw-rw-r--  1 super super   1759  6月 16 22:38 Kconfig.debug
drwxrwxr-x  2 super super   4096 10月 22 20:48 lib
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-exynos
drwxrwxr-x 13 super super   4096  6月 16 22:38 mach-imx
drwxrwxr-x 14 super super   4096  6月 16 22:38 mach-k3
drwxrwxr-x 13 super super   4096  6月 16 22:38 mach-mediatek
drwxrwxr-x  6 super super   4096  6月 16 22:38 mach-omap2
drwxrwxr-x  2 super super   4096  6月 16 22:38 mach-qemu
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-renesas
drwxrwxr-x 17 super super   4096  6月 16 22:38 mach-rockchip
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-socfpga
drwxrwxr-x  2 super super   4096  6月 16 22:38 mach-sti
drwxrwxr-x  5 super super   4096 10月 22 20:48 mach-stm32
drwxrwxr-x  6 super super   4096  6月 16 22:38 mach-stm32mp
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-sunxi
drwxrwxr-x  8 super super   4096  6月 16 22:38 mach-tegra
drwxrwxr-x  2 super super   4096  6月 16 22:38 mach-u8500
drwxrwxr-x  9 super super   4096  6月 16 22:38 mach-uniphier
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-versal
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-versal-net
drwxrwxr-x  2 super super   4096  6月 16 22:38 mach-versatile
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-zynq
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-zynqmp
drwxrwxr-x  3 super super   4096  6月 16 22:38 mach-zynqmp-r5
-rw-rw-r--  1 super super   3922  6月 16 22:38 Makefile
drwxrwxr-x  3 super super   4096  6月 16 22:38 thumb1
```

### arch/arm/cpu文件夹
与arm架构相关代码，在子文件夹下  **start.S** 汇编文件中包含各个架构复位向量代码(上电运行代码入口)

```shell
super@rocket:~/Downloads/u-boot/arch/arm/cpu$ ls -l
total 60
drwxrwxr-x  2 super super 4096  6月 16 22:38 arm11
drwxrwxr-x  3 super super 4096  6月 16 22:38 arm1136
drwxrwxr-x  2 super super 4096  6月 16 22:38 arm1176
drwxrwxr-x  2 super super 4096  6月 16 22:38 arm720t
drwxrwxr-x  2 super super 4096  6月 16 22:38 arm920t
drwxrwxr-x  4 super super 4096  6月 16 22:38 arm926ejs
drwxrwxr-x  2 super super 4096  6月 16 22:38 arm946es
drwxrwxr-x 12 super super 4096  6月 16 22:38 armv7
drwxrwxr-x  2 super super 4096 10月 22 20:48 armv7m
drwxrwxr-x  6 super super 4096  6月 16 22:38 armv8
-rw-rw-r--  1 super super    8 10月 22 20:48 built-in.o
-rw-rw-r--  1 super super   53  6月 16 22:38 Makefile
-rw-rw-r--  1 super super 4681  6月 16 22:38 u-boot.lds
-rw-rw-r--  1 super super 1712  6月 16 22:38 u-boot-spl.lds
```

### arch/arm/dts文件夹
u-boot使用的设备树文件

```shell
super@rocket:~/Downloads/u-boot/arch/arm/dts$ ll
total 1108
drwxrwxr-x  3 super super 131072 10月 22 20:48 ./
drwxrwxr-x 55 super super   4096  6月 16 22:38 ../
-rw-rw-r--  1 super super    444 10月  9 23:17 armv7-m.dtsi
drwxrwxr-x  2 super super   4096  6月 16 22:38 include/
-rw-rw-r--  1 super super  35581 10月 13 21:40 Makefile
-rw-rw-r--  1 super super  15521 10月 19 22:51 stm32h743.dtsi
-rw-rw-r--  1 super super   3066 10月 19 21:16 stm32h743i-atk.dts
-rw-rw-r--  1 super super   2067  6月 16 23:53 stm32h743i-atk-u-boot.dtsi
-rw-rw-r--  1 super super   1367  6月 16 22:38 stm32h743i-disco.dts
-rw-rw-r--  1 super super   2646  6月 16 22:38 stm32h743i-disco-u-boot.dtsi
-rw-rw-r--  1 super super   4188  6月 23 00:19 stm32h743i-eval.dts
-rw-rw-r--  1 super super   2646  6月 16 22:38 stm32h743i-eval-u-boot.dtsi
-rw-rw-r--  1 super super    149  6月 16 22:38 stm32h750.dtsi
-rw-rw-r--  1 super super   3479  6月 16 22:38 stm32h750i-art-pi.dts
-rw-rw-r--  1 super super   2006  6月 16 22:38 stm32h750i-art-pi-u-boot.dtsi
-rw-rw-r--  1 super super   8103 10月  8 20:53 stm32h7-pinctrl.dtsi
-rw-rw-r--  1 super super   1555  6月 16 22:38 stm32h7-u-boot.dtsi
-rw-rw-r--  1 super super  36819  6月 16 22:38 stm32mp131.dtsi
-rw-rw-r--  1 super super   1833  6月 16 22:38 stm32mp133.dtsi
-rw-rw-r--  1 super super    255  6月 16 22:38 stm32mp135.dtsi
-rw-rw-r--  1 super super   7417  6月 16 22:38 stm32mp135f-dk.dts
-rw-rw-r--  1 super super    873  6月 16 22:38 stm32mp135f-dk-u-boot.dtsi
-rw-rw-r--  1 super super   9090  6月 16 22:38 stm32mp13-pinctrl.dtsi
-rw-rw-r--  1 super super   1097  6月 16 22:38 stm32mp13-u-boot.dtsi
-rw-rw-r--  1 super super    451  6月 16 22:38 stm32mp13xc.dtsi
-rw-rw-r--  1 super super    451  6月 16 22:38 stm32mp13xf.dtsi
-rw-rw-r--  1 super super  45494  6月 16 22:38 stm32mp151.dtsi
-rw-rw-r--  1 super super    730  6月 16 22:38 stm32mp153c-dhcor-drc-compact.dts
-rw-rw-r--  1 super super   1680  6月 16 22:38 stm32mp153.dtsi
...
```

### board文件
一般是半导体厂商SOC对应的官方demo板卡

```shell
super@rocket:~/Downloads/u-boot/board$ ll
total 772
drwxrwxr-x 193 super super 4096  6月 16 22:38 ./
drwxrwxr-x  30 super super 4096 10月 22 22:57 ../
drwxrwxr-x   3 super super 4096  6月 16 22:38 abilis/
drwxrwxr-x   6 super super 4096  6月 16 22:38 advantech/
drwxrwxr-x   7 super super 4096  6月 16 22:38 alliedtelesis/
drwxrwxr-x   7 super super 4096  6月 16 22:38 altera/
drwxrwxr-x   3 super super 4096  6月 16 22:38 amarula/
drwxrwxr-x  18 super super 4096  6月 16 22:38 amlogic/
drwxrwxr-x   3 super super 4096  6月 16 22:38 anbernic/
drwxrwxr-x   3 super super 4096  6月 16 22:38 andestech/
drwxrwxr-x   3 super super 4096  6月 16 22:38 aries/
drwxrwxr-x   3 super super 4096  6月 16 22:38 aristainetos/
drwxrwxr-x   2 super super 4096  6月 16 22:38 maxbcm/
drwxrwxr-x  16 super super 4096  6月 16 22:38 mediatek/
drwxrwxr-x   4 super super 4096  6月 16 22:38 menlo/
drwxrwxr-x   4 super super 4096  6月 16 22:38 microchip/
drwxrwxr-x   3 super super 4096  6月 16 22:38 mikrotik/
drwxrwxr-x   3 super super 4096  6月 16 22:38 mntre/
drwxrwxr-x   3 super super 4096  6月 16 22:38 mqmaker/
drwxrwxr-x   3 super super 4096  6月 16 22:38 msc/
drwxrwxr-x   8 super super 4096  6月 16 22:38 mscc/
drwxrwxr-x   3 super super 4096  6月 16 22:38 rikomagic/
drwxrwxr-x  18 super super 4096  6月 16 22:38 rockchip/
drwxrwxr-x   3 super super 4096  6月 16 22:38 somlabs/
drwxrwxr-x   3 super super 4096  6月 16 22:38 sophgo/
drwxrwxr-x   3 super super 4096  6月 16 22:38 sr1500/
drwxrwxr-x  14 super super 4096  6月 18 23:12 st/
drwxrwxr-x   7 super super 4096  6月 16 22:38 theobroma-systems/
drwxrwxr-x  19 super super 4096  6月 16 22:38 ti/
drwxrwxr-x   3 super super 4096  6月 16 22:38 xen/
drwxrwxr-x  11 super super 4096  6月 16 22:38 xilinx/
drwxrwxr-x   4 super super 4096  6月 16 22:38 zyxel/
...
```


## 基本流程



## 重要文件



